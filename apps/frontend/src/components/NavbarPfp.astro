---
import Layout from '../layouts/Layout.astro';

// Server-side data fetching
let user = null;

const token = Astro.cookies.get('jwt_token')?.value;

if (token) {
  try {
    const response = await fetch(`${import.meta.env.PUBLIC_API_URL}/auth/me`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    const data = await response.json();
    
    if (data.success) {
      user = data.user;
    }
  } catch (e) {
    console.error(e);
  }
}

// Redirect if not authenticated
if (!user) {
  return Astro.redirect('/login');
}
---

<Layout>
  <div class="container mx-auto p-6">
    <h1>Welcome, {user.name}!</h1>
    <p>Email: {user.email}</p>
    <p>Tier: {user.tier}</p>
  </div>
</Layout>